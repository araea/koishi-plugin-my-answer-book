# koishi-plugin-my-answer-book

[![npm](https://img.shields.io/npm/v/koishi-plugin-my-answer-book?style=flat-square)](https://www.npmjs.com/package/koishi-plugin-my-answer-book)

## 🎈 介绍

My Answer Book 是一个基于 koishi 框架的插件，它可以让你通过一个简单的命令，翻开一本神秘的书，得到你心中问题的答案。📚

你可以在脑海中提出任何问题，这本书会以文字或图像的方式给你答案。

## 👨‍💻 插件状态

- 使用 Schema 模块，定义插件的配置项，并提供默认值和描述。
- 通过 puppeteer-core 模块，使用无头浏览器访问 [myanswersbook.com](https://www.myanswersbook.com/zh-cn.html) 网站，模拟用户点击书本的操作，获取网页上的文本和图片。
- 根据用户的配置，返回不同的答案模式，包括图片模式和文本模式（中文、英文、中英文），并可以选择是否添加空格。
- 使用 crypto 模块，生成随机的浏览器版本号和用户代理字符串，防止被网站识别为机器人。
- 使用 puppeteer-finder 模块，自动查找本机安装的 Chrome / Firefox / Edge 浏览器，无需手动指定路径。
- 使用 fetch 方法，调用一言的 api，获取一句话作为重试提示词，显示在控制台。
- 使用 retry 函数，实现具有指数回退的重试机制，避免因为网络或其他原因导致请求失败。

## 📦 安装

```
前往 Koishi 插件市场添加该插件即可
```

## 📝 命令

本插件提供了以下两个指令：

- `answerBook`：显示本插件的指令帮助。
- `翻开答案之书`：翻开答案之书，获取你心中问题的答案。你可以在配置项中设置答案的模式，包括图片模式和文本模式（中文、英文、中英文），并可以选择是否添加空格。

## 🎮 使用

- 在聊天窗口中，输入 `answerBook` 命令，查看帮助信息
- 输入 `翻开答案之书` 命令，翻开答案之书
- 在心中默念你的问题，等待答案之书给你答案
- 根据你的喜好，修改配置项，更改答案之书的返回结果

## ⚙️ 配置

本插件的配置项如下：

- `sentText`：触发指令后发送的文本，可以是默认的`在心中默念你的问题，之后答案之书会给你答案。`，也可以是自定义的字符串，或者是`false`表示不发送文本。
- `waitTime`：翻开答案之书后等待发送答案的时间，单位是秒，默认为0。
- `answerBookResultPattern`：答案之书返回结果的模式，可以是以下几种之一：
  - `图片模式`：返回一个包含答案的图片，图片的质量可以在配置项中设置。
  - `中文文本模式`：返回一个包含答案的中文文本，不带空格。
  - `中文文本模式(带空格)`：返回一个包含答案的中文文本，每个汉字之间带有空格。
  - `英文(小写)文本模式`：返回一个包含答案的英文文本，全部小写。
  - `英文(大写)文本模式`：返回一个包含答案的英文文本，全部大写。
  - `中英文(小写)文本模式`：返回一个包含答案的中英文文本，分为两行，第一行是英文（全部小写），第二行是中文（不带空格）。
  - `中英文(小写)文本模式(带空格)`：返回一个包含答案的中英文文本，分为两行，第一行是英文（全部小写），第二行是中文（每个汉字之间带有空格）。
  - `中英文(大写)文本模式`：返回一个包含答案的中英文文本，分为两行，第一行是英文（全部大写），第二行是中文（不带空格）。
  - `中英文(大写)文本模式(带空格)`：返回一个包含答案的中英文文本，分为两行，第一行是英文（全部大写），第二行是中文（每个汉字之间带有空格）。
- `isEnableImageCompression`：是否启用图片压缩，默认为`true`。如果启用图片压缩，则需要设置以下配置项：
  - `PictureQuality`：压缩后图片的质量，范围是1到100，默认为80。

## 🙏 致谢

* [Koishi](https://koishi.chat/)：机器人框架
* [myanswersbook.com](https://www.myanswersbook.com/zh-cn.html)：功能实现服务

## 📄 License

MIT License © 2023